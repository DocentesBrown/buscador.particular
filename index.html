<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buscador de Docentes Particulares</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    h1 {
      text-align: center;
    }
    .filtros {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    select, button {
      padding: 8px;
      font-size: 16px;
    }
    .tarjeta {
      background-color: #fff;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .estrella {
      color: gold;
      font-size: 20px;
    }
    .resultados {
      max-width: 800px;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <h1>Buscador de Docentes Particulares</h1>

  <div class="filtros">
    <label>Zona:
      <select id="filtroZona"><option value="">Todas</option></select>
    </label>
    <label>Materia:
      <select id="filtroMateria"><option value="">Todas</option></select>
    </label>
    <label>Localidad:
      <select id="filtroLocalidad"><option value="">Todas</option></select>
    </label>
    <button onclick="buscarDocentes()">Buscar</button>
  </div>

  <div class="resultados" id="resultados"></div>

  <script>
    const url = "https://script.google.com/macros/s/AKfycbx_78vOy4GyHUxoCcteKWwTchhpa_1drRBXBMjTdJAm_iGoMiLHXp0na-xNuf6gxvRb/exec";
    let datosDocentes = [];

    window.onload = async () => {
      const response = await fetch(url);
      datosDocentes = await response.json();
      cargarFiltros(datosDocentes);
    };

    function cargarFiltros(datos) {
      const zonas = [...new Set(datos.map(d => d["Zona"]).filter(Boolean))].sort();
      const materias = [...new Set(datos.map(d => d["Materia"]).filter(Boolean))].sort();
      const localidades = [...new Set(datos.map(d => d["Localidad"]).filter(Boolean))].sort();

      zonas.forEach(z => filtroZona.add(new Option(z, z)));
      materias.forEach(m => filtroMateria.add(new Option(m, m)));
      localidades.forEach(l => filtroLocalidad.add(new Option(l, l)));
    }

    function buscarDocentes() {
      const zona = filtroZona.value;
      const materia = filtroMateria.value;
      const localidad = filtroLocalidad.value;

      const filtrados = datosDocentes.filter(doc => {
        return (!zona || doc["Zona"] === zona) &&
               (!materia || doc["Materia"] === materia) &&
               (!localidad || doc["Localidad"] === localidad);
      });

      mostrarResultados(filtrados);
    }

    function mostrarResultados(docentes) {
      const contenedor = document.getElementById("resultados");
      contenedor.innerHTML = "";

      docentes.forEach(doc => {
        const nombre = `${doc["Nombre"]} ${doc["Apellido"]}`;
        const whatsapp = `https://wa.me/${String(doc["Celular"]).replace(/[^0-9]/g, '')}`;
        const calificacion = parseFloat(doc["Calificación"]) || 0;
        const estrellas = mostrarEstrellas(calificacion);

        const tarjeta = `
          <div class="tarjeta">
            <h3>${nombre}</h3>
            <p><strong>Zona:</strong> ${doc["Zona"]}</p>
            <p><strong>Materia:</strong> ${doc["Materia"]}</p>
            <p><strong>Localidad:</strong> ${doc["Localidad"]}</p>
            <p><strong>Precio:</strong> ${doc["Precio por Hora"]}</p>
            <p><strong>Modalidad:</strong> 
              ${doc["Domicilio Propio"] ? "Domicilio propio" : ""} 
              ${doc["Otro Domicilio"] ? "Otro domicilio" : ""} 
              ${doc["Virtual"] ? "Virtual" : ""} 
            </p>
            <p>${estrellas}</p>
            <button onclick="window.open('${whatsapp}', '_blank')">Contactarse por WhatsApp</button>
            <button onclick="calificarDocente('${doc["Nombre"]}', '${doc["Apellido"]}')">Calificar</button>
          </div>
        `;

        contenedor.innerHTML += tarjeta;
      });
    }

    function mostrarEstrellas(puntaje) {
      let html = '';
      for (let i = 1; i <= 5; i++) {
        if (puntaje >= i) html += '★';
        else if (puntaje >= i - 0.5) html += '☆';
        else html += '✩';
      }
      return `<span class="estrella">${html}</span>`;
    }

    function calificarDocente(nombre, apellido) {
      const puntaje = prompt(`¿Cuánto lo calificarías a ${nombre} ${apellido}? (0 a 5)`);
      const comentario = prompt("¿Querés dejar un comentario?");
      if (puntaje !== null && comentario !== null) {
        alert("Gracias por tu calificación. Pronto será registrada.");
        // Aquí se puede llamar a otro Apps Script para guardar la calificación
      }
    }
  </script>
</body>
</html>
