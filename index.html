<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buscador de Docentes</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .filters { margin-bottom: 20px; }
    .card {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
    }
    .stars {
      color: gold;
      font-size: 1.2em;
    }
    .button {
      display: inline-block;
      margin-top: 10px;
      padding: 10px 15px;
      background-color: #28a745;
      color: white;
      text-decoration: none;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h1>Buscador de Docentes</h1>
  <div class="filters">
    <select id="zonaSelect">
      <option value="">Seleccione Zona</option>
    </select>
    <select id="localidadSelect">
      <option value="">Seleccione Localidad</option>
    </select>
    <select id="materiaSelect">
      <option value="">Seleccione Materia</option>
    </select>
    <button onclick="buscarDocentes()">Buscar</button>
  </div>
  <div id="resultados"></div>

  <script>
    let docentes = [];

    fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vT2QSxoKtG7qZquMBE724lvFai2Ms0SyVHx5fYNiV141zPQtq45nKTSBmkkhfTf5OXX8UMi6MzoS-Jd/pub?output=csv")
      .then(response => response.text())
      .then(data => {
        const lines = data.split("\n").slice(1);
        docentes = lines.map(line => line.split(","));
        cargarFiltros();
      });

    function cargarFiltros() {
      const zonas = [...new Set(docentes.map(d => d[1]))].sort();
      const localidades = [...new Set(docentes.map(d => d[11]))].sort();
      const materias = [...new Set(docentes.map(d => d[10]))].sort();

      zonas.forEach(z => agregarOpcion("zonaSelect", z));
      localidades.forEach(l => agregarOpcion("localidadSelect", l));
      materias.forEach(m => agregarOpcion("materiaSelect", m));
    }

    function agregarOpcion(id, valor) {
      const select = document.getElementById(id);
      const option = document.createElement("option");
      option.value = valor;
      option.textContent = valor;
      select.appendChild(option);
    }

    function buscarDocentes() {
      const zona = document.getElementById("zonaSelect").value;
      const localidad = document.getElementById("localidadSelect").value;
      const materia = document.getElementById("materiaSelect").value;

      const resultados = docentes.filter(d =>
        (!zona || d[1] === zona) &&
        (!localidad || d[11] === localidad) &&
        (!materia || d[10] === materia)
      );

      mostrarResultados(resultados);
    }

    function mostrarResultados(lista) {
      const contenedor = document.getElementById("resultados");
      contenedor.innerHTML = "";

      lista.forEach(d => {
        const estrellas = obtenerEstrellas(parseFloat(d[12]));
        const whatsapp = `https://wa.me/${d[4].replace(/[^\d]/g, '')}?text=Hola, encontré tu contacto en el buscador de Docentes Brown...`;
        const card = `
          <div class="card">
            <strong>${d[2]}, ${d[3]}</strong><br>
            Zona: ${d[1]}<br>
            Localidad: ${d[11]}<br>
            Materia: ${d[10]}<br>
            Nivel: ${d[9]}<br>
            Precio por hora: ${d[8]}<br>
            Contacto: ${d[4]}<br>
            Domicilio: ${d[5] || d[6]}<br>
            Virtual: ${d[7]}<br>
            Calificación: <span class="stars">${estrellas}</span><br>
            <a class="button" href="${whatsapp}" target="_blank">Contactarse por WhatsApp</a>
            <a class="button" href="https://forms.gle/on9vLtRGUnqp7fPE6" target="_blank" style="background-color:#007bff">Calificar Docente</a>
          </div>
        `;
        contenedor.innerHTML += card;
      });
    }

    function obtenerEstrellas(valor) {
      const llenas = Math.floor(valor);
      const media = (valor % 1) >= 0.5 ? 1 : 0;
      let estrellas = "";
      for (let i = 0; i < llenas; i++) estrellas += "★";
      if (media) estrellas += "☆";
      for (let i = llenas + media; i < 5; i++) estrellas += "✩";
      return estrellas;
    }
  </script>
</body>
</html>
